---
export const prerender = false;
import getGithubProjects from "../../actions/getGithubProjects";
import ProjectCard from "../../components/projects/ProjectCard.astro";
import Layout from "../../layouts/Layout.astro";
import getTextI18 from "../../utils/getTexti18";
import getSupportedLangs from "../../utils/lang";

export function getStaticPaths() {
  return getSupportedLangs();
}

const { lang } = Astro.params as { lang: string };

const not_found = await getTextI18(lang, "projects_not_found");

const projects = await getGithubProjects();

const projects_filter = projects.filter((project) => project.description);

Astro.cookies.set(
  "projects",
  JSON.stringify(projects_filter.map((project) => project.name)),
  {
    httpOnly: true,
    sameSite: true,
    secure: true,
  },
);
---

<Layout>
  <section>
    {
      projects.length === 0 && (
        <div class="flex flex-col gap-2 items-center">
          <h2 class="text-custom font-bold text-xl font-montserrat">
            {not_found}
          </h2>
          <img
            src="https://http.cat/images/404.jpg"
            alt="Cat 404"
            class="w-96 rounded-lg"
          />
        </div>
      )
    }

    <div class="flex flex-wrap gap-6">
      {projects_filter.map((project) => <ProjectCard {...project} />)}
    </div>
  </section>
</Layout>
